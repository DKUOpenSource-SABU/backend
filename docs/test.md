# 📈 Backend 성능 테스트 보고서 (k6 기반)

본 문서는 K6 오픈소스 부하 테스트 도구를 활용하여 `/api` 주요 엔드포인트의 성능을 점검한 결과를 정리한 문서입니다.  
테스트는 **단일 프로세스(Uvicorn)** 및 **멀티 프로세스(Gunicorn)** 환경에서 각각 수행되었습니다.

---

## 🔧 테스트 환경

- **도구**: [k6](https://k6.io/) (Local Mode)
- **시나리오**: 60 VUs, 10s 루프, 최대 40s 실행
- **서버 모드**:
  - 초기: `uvicorn main:app --reload`
  - 이후: `gunicorn main:app --workers 4 --worker-class uvicorn.workers.UvicornWorker`

---

## 🧪 테스트 결과 요약

| 엔드포인트 | 평균 응답 시간 | 실패율 | VUs | TPS(평균) | 비고 |
|------------|----------------|--------|-----|-----------|------|
| `/search/ticker` (초기) | 829ms | 25% | 60 | ~72r/s | 초기 응답 지연 및 오류 일부 |
| `/search/ticker` (개선) | 227ms | 25% | 60 | ~253r/s | 멀티 프로세싱 후 처리량 상승 |
| `/leaderboard` | 23ms | 0% | 60 | ~2,493r/s | 매우 빠르고 안정적 |
| `/backtest` (초기) | 18.7s | 10% | 60 | ~1.4r/s | 연산 과중으로 응답 지연 |
| `/backtest` (개선) | 2.3s | 7.4% | 60 | ~19r/s | 개선됐으나 여전히 병목 있음 |
| `/cluster/analyze` | 42ms → 10ms | 33% → 33% | 60 | ~1,400 → 5,600r/s | 응답 빠르나 실패율 주의 |
| `/cluster/recommend` | 414ms → 102ms | 50% → 0% | 60 | ~144r/s → 572r/s | 성공률 상승, 성능 향상 |
| `/cluster/score` | 546ms → 355ms | 66% → 0% | 60 | ~107r/s → 164r/s | 실패율 크게 감소 |
| `/cluster/sectors` | 22ms → 5ms | 0% | 60 | ~2,600r/s → 11,700r/s | 가장 빠르고 안정적 |

> ✅ **멀티 프로세스 전환(Gunicorn) 이후 평균 응답 시간이 크게 개선**되었으며, `/leaderboard`, `/cluster/sectors`는 높은 안정성과 처리량을 보임

---

## 📌 엔드포인트별 상세 분석

### 🔍 `/search/ticker`
- **성능**: 초기 829ms → 개선 후 227ms  
- **문제점**: 쿼리 조건에 따라 일부 요청 실패 (`422`, `400`)
- **개선점**: 유효성 검사 보완 필요, 에러 케이스 처리 강화

---

### 📊 `/leaderboard`
- **성능**: 평균 23ms, 실패율 0%
- **특징**: 캐시 기반 응답이 빠르게 동작, 처리량 매우 우수

---

### 📉 `/backtest`
- **성능**: 초기 평균 18.7초 → 개선 후 2.3초
- **문제점**: 전략 수와 데이터 양에 따라 매우 긴 연산 시간 소요
- **개선점**:
  - 백테스트 전략 병렬 처리
  - 캐시 활용 (`diskcache`) 확대 필요
  - 특정 전략만 요청 시 연산 줄이기

---

### 🧠 `/cluster/analyze`
- **성능**: 응답 시간 평균 10ms 수준
- **문제점**: 약 33% 요청 실패 (`422`, `400` 응답)
- **개선점**: 클러스터링 입력값 유효성 검증 강화 필요

---

### 🧭 `/cluster/recommend`
- **성능**: 응답 시간 102ms, 성공률 100%
- **개선점**: API 안정성 확보 성공. 향후 전략별 추천 성능 향상 고려

---

### 🎯 `/cluster/score`
- **성능**: 응답 시간 평균 355ms, 초기 실패율 66% → 0%로 개선
- **개선점**: 필드 누락 등 JSON 파싱 오류 해결됨

---

### 🗺 `/cluster/sectors`
- **성능**: 평균 5ms 응답, TPS 11,700, 실패율 0%
- **결론**: 가장 안정적이고 효율적인 API


## ✅ 요약 및 개선 포인트

- **멀티 프로세싱 적용 후** 대부분의 API 성능 대폭 향상
- `/backtest`는 여전히 **연산 병목 존재** → **비동기/멀티프로세싱/캐시 적용 확대 필요**
- `/cluster` 계열은 입력 값에 따라 에러율 변동 → **유효성 처리 보완 필요**
- 캐시 미적용 경로에 대해서는 추후 **디스크/메모리 캐시 구조 도입 검토**

---

## 📎 테스트 스크립트 위치

```bash
📂 tests/
 ┣ 📜 search/ticker.js
 ┣ 📜 backtest.js
 ┣ 📜 cluster/analyze.js
 ┣ 📜 cluster/recommend.js
 ┣ 📜 cluster/score.js
 ┗ 📜 cluster/sectors.js
```